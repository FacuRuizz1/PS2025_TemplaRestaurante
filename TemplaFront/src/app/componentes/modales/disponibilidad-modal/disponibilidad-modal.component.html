<div class="modal-backdrop" *ngIf="isVisible" (click)="cancelar()"></div>

<div class="modal-container" *ngIf="isVisible">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <!-- Header -->
    <div class="modal-header">
      <h2 class="modal-title">üìÖ Crear Disponibilidades Mensuales</h2>
      <button type="button" class="btn-close" (click)="cancelar()" [disabled]="isLoading">
        ‚úñ
      </button>
    </div>

    <!-- Body -->
    <div class="modal-body">
      <div class="form-container">
        
        <!-- Descripci√≥n -->
        <div class="alert alert-info">
          <strong>‚ÑπÔ∏è Informaci√≥n:</strong> Este formulario crear√° disponibilidades para todos los d√≠as del mes seleccionado con los cupos especificados.
        </div>

        <!-- Selecci√≥n de A√±o y Mes -->
        <div class="form-row">
          <!-- Selecci√≥n de A√±o -->
          <div class="form-group">
            <label for="anio" class="form-label">
              <strong>A√±o</strong> <span class="text-danger">*</span>
            </label>
            <select 
              id="anio" 
              class="form-control" 
              [(ngModel)]="anioSeleccionado"
              [disabled]="isLoading">
              <option *ngFor="let anio of anios" [value]="anio">
                {{ anio }}
              </option>
            </select>
          </div>

          <!-- Selecci√≥n de Mes -->
          <div class="form-group">
            <label for="mes" class="form-label">
              <strong>Mes</strong> <span class="text-danger">*</span>
            </label>
            <select 
              id="mes" 
              class="form-control" 
              [(ngModel)]="mesSeleccionado"
              [disabled]="isLoading">
              <option *ngFor="let mes of obtenerMesesDisponibles()" [value]="mes.valor">
                {{ mes.nombre }}
              </option>
            </select>
          </div>
        </div>

        <!-- Cupos M√°ximos -->
        <div class="form-group">
          <label for="cupos" class="form-label">
            <strong>Cupos M√°ximos por D√≠a</strong> <span class="text-danger">*</span>
          </label>
          <input 
            type="number" 
            id="cupos" 
            class="form-control" 
            [(ngModel)]="cuposMaximos"
            [disabled]="isLoading"
            min="1"
            max="500"
            placeholder="Ej: 100">
          <small class="form-text text-muted">
            Cantidad de comensales que se pueden reservar por d√≠a
          </small>
        </div>

        <!-- Estado Activo -->
        <div class="form-group">
          <div class="form-check">
            <input 
              type="checkbox" 
              id="activo" 
              class="form-check-input" 
              [(ngModel)]="activo"
              [disabled]="isLoading">
            <label for="activo" class="form-check-label">
              <strong>Disponibilidades activas</strong>
            </label>
          </div>
          <small class="form-text text-muted">
            Si est√° desactivado, las fechas no aceptar√°n reservas
          </small>
        </div>

        <!-- Separador -->
        <hr class="section-divider">

        <!-- Exclusiones (Opcional) -->
        <div class="exclusiones-section">
          <h5 class="section-title">üö´ Excluir D√≠as (Opcional)</h5>
          <small class="form-text text-muted mb-3" style="display: block;">
            Selecciona d√≠as que NO deseas habilitar (ej: d√≠as de cierre del restaurante)
          </small>

          <!-- Excluir d√≠as de la semana -->
          <div class="form-group">
            <label class="form-label">
              <strong>Excluir d√≠as de la semana</strong>
            </label>
            <div class="dias-semana-grid">
              <button 
                type="button"
                *ngFor="let dia of diasSemana"
                class="dia-semana-btn"
                [class.selected]="isDiaSemanaExcluido(dia.valor)"
                [disabled]="isLoading"
                (click)="toggleDiaSemana(dia.valor)">
                {{ dia.nombre }}
              </button>
            </div>
            <small class="form-text text-muted">
              Ejemplo: Selecciona "Domingo" para excluir todos los domingos del mes
            </small>
          </div>

          <!-- Excluir d√≠as espec√≠ficos -->
          <div class="form-group">
            <label class="form-label">
              <strong>Excluir d√≠as espec√≠ficos del mes</strong>
            </label>
            <div class="dias-mes-grid">
              <button 
                type="button"
                *ngFor="let dia of obtenerArrayDiasMes()"
                class="dia-mes-btn"
                [class.selected]="isDiaMesExcluido(dia)"
                [disabled]="isLoading"
                (click)="toggleDiaMes(dia)">
                {{ dia }}
              </button>
            </div>
            <small class="form-text text-muted">
              Ejemplo: Selecciona el d√≠a 25 para no crear disponibilidad ese d√≠a
            </small>
          </div>
        </div>

        <!-- Resumen -->
        <div class="resumen-card" *ngIf="!isLoading">
          <h5>üìä Resumen</h5>
          <hr>
          <p><strong>Per√≠odo:</strong> {{ obtenerNombreMes() }} {{ anioSeleccionado }}</p>
          <p><strong>Total de d√≠as del mes:</strong> {{ obtenerDiasDelMes() }}</p>
          <p *ngIf="diasSemanaExcluidos.length > 0" class="text-warning">
            <strong>D√≠as de semana excluidos:</strong> {{ diasSemanaExcluidos.length }} tipo(s)
          </p>
          <p *ngIf="diasMesExcluidos.length > 0" class="text-warning">
            <strong>D√≠as espec√≠ficos excluidos:</strong> {{ diasMesExcluidos.length }}
          </p>
          <p><strong>D√≠as a crear:</strong> {{ calcularDiasACrear() }}</p>
          <p><strong>Cupos por d√≠a:</strong> {{ cuposMaximos }}</p>
        </div>

        <!-- Loading -->
        <div class="loading-container" *ngIf="isLoading">
          <div class="spinner-border text-primary" role="status">
            <span class="visually-hidden">Creando disponibilidades...</span>
          </div>
          <p class="mt-2">Creando disponibilidades, por favor espere...</p>
        </div>

      </div>
    </div>

    <!-- Footer -->
    <div class="modal-footer">
      <button 
        type="button" 
        class="btn btn-secondary" 
        (click)="cancelar()"
        [disabled]="isLoading">
        Cancelar
      </button>
      <button 
        type="button" 
        class="btn btn-primary" 
        (click)="crearDisponibilidades()"
        [disabled]="isLoading || cuposMaximos <= 0">
        <span *ngIf="!isLoading">‚úÖ Crear Disponibilidades</span>
        <span *ngIf="isLoading">
          <span class="spinner-border spinner-border-sm" role="status"></span>
          Creando...
        </span>
      </button>
    </div>
  </div>
</div>
